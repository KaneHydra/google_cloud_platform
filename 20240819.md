---
id: "20240819"
aliases: []
tags: []
---

# 20240819

## 建立專案 與 資料集

1. 建立專案 `ai-project-座號-0819`

2. 左上三條線 => API和服務 => 程式庫, 搜尋並啟用以下服務：

    - BigQuery API
    - Vertex AI API
    - Cloud Storage

3. 開啟 Big Query Studio,  
   點左邊`ai-project-座號-0819`右邊的三個點,  
   建立資料庫：

    - 名稱`ai_dataset_座號`,
    - 地區 多地區 US

4. 左邊Explorer右邊的的新增 => 右上的 連接至外部資料來源 =>

    - Vertex AI 遠端模型、遠端函式和 BigLake Cloud 資源
    - 名稱 `ai_content`,
    - 地區 要跟上面的相同

5. 建完之後點左邊的外部連線 => `us_ai_content` => 複製右邊的服務帳戶ID

6. 左上三條線 => IAM 管理 => 身份和存取權管理 => 中間的 授予存取權 =>
    - 新增主體 貼上剛才複製的服務帳號ID
    - 指派角色：
        - BigQuery使用者,
        - Storage管理員,
        - VertexAI使用者

## 導入時間序列資料集

[查看老師的講義](https://hackmd.io/@4HupY3slSPWy7VByk-0aXA/r1TUvEvuC#0819課程資料)

[針對Google Analytics範例進行時間序列分析](https://hackmd.io/@4HupY3slSPWy7VByk-0aXA/BJGC-2UOR)

左上角三條線 => Big Query Studio => 中間輸入框上方正方形的加號 就是 新增查詢

1. 可視化時間序列

新增查詢, 並儲存為 `查詢時間序列`

```sql
SELECT
  PARSE_TIMESTAMP("%Y%m%d", date) AS parsed_date,
  SUM(totals.visits) AS total_visits
FROM
  `bigquery-public-data.google_analytics_sample.ga_sessions_*`
GROUP BY date
```

2. 新增另一個查詢, 創建時間序列模型

資料集ID 為 `ai-project-座號-0819.ai_dataset_座號`

```sql
CREATE OR REPLACE MODEL `資料集ID.ga_arima_model`
OPTIONS (
    model_type = 'ARIMA_PLUS',
    -- 對應下方選擇的欄位
    time_series_timestamp_col = 'parsed_date',
    time_series_data_col = 'total_visits',
    --其他參數
    auto_arima = TRUE,
    data_frequency = 'AUTO_FREQUENCY',
    decompose_time_series = TRUE
) AS
-- 查詢時間序列
SELECT
  PARSE_TIMESTAMP("%Y%m%d", date) AS parsed_date,
  SUM(totals.visits) AS total_visits
FROM
  `bigquery-public-data.google_analytics_sample.ga_sessions_*`
GROUP BY date
```
